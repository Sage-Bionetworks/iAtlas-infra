template_path: ecs.yaml
stack_name: iatlas-staging
dependencies:
  - common/iatlasvpc.yaml
  - staging/iatlas-api-certificate.yaml
  - staging/iatlas-api-hostedzone.yaml
  - staging/iatlas-db.yaml
stack_tags: {{stack_group_config.stack_tags}}
parameters:
  InstanceType: 't3a.medium'
  KeyName: 'iatlas-api-staging' # For this to work, this key must be added in the SAGE AWS.
  VpcId: !stack_output_external iatlasvpc::VPCId
  BastionHostSgId: !stack_output_external iatlasvpc::BastianSecurityGroup
  PublicSubnetId:
    - !stack_output_external iatlasvpc::PublicSubnet
    - !stack_output_external iatlasvpc::PublicSubnet1
    - !stack_output_external iatlasvpc::PublicSubnet2
  PrivateSubnetId:
    - !stack_output_external iatlasvpc::PrivateSubnet
    - !stack_output_external iatlasvpc::PrivateSubnet1
    - !stack_output_external iatlasvpc::PrivateSubnet2
  DesiredCapacity: '1'
  MaxSize: '2'
  DockerImageTag: {{stack_group_config.docker_image_tag}}
  FlaskEnv: 'staging'
  CertificateArn: !stack_output_external iatlas-api-certificate-staging::CertificateArn
  DomainName: '{{stack_group_config.sub_domain_name_staging}}.{{stack_group_config.domain_name_staging}}'
  DbHost: !stack_output_external iatlasdb-staging::ClusterReadEndpoint
  SecretDbNameKey: 'dbname_staging'
  SecretPasswordKey: 'password_staging'
  SecretUsernameKey: 'username_staging'
